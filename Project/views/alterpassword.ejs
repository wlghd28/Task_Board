
<p><br>
<div class="container">  <!-- container class 가 페이지의 컨텐츠영역을 지정 -->
<div class="jumbotron" style="margin:auto">

<div class="bm-login-form" style='margin-left:auto; margin-right:auto; border:1px'>

<div class="starter-template">
    <h5>비밀번호 변경</h5> <hr>
</div>

<form id="join" name=join onsubmit="return validate()" method=post action="/user/alterpassword?_method=PUT">
    <div class="form-group">
    <label for="exampleInputPassword1">현재 비밀번호</label>
    <input type="password" class="form-control" name="current_pw" id="current_pw" placeholder="현재 암호를 입력하세요">
    </div>
    <div class="form-group">
    <label for="exampleInputPassword2">새로운 비밀번호</label>
    <input type="password" class="form-control" name="new_pw1" id="new_pw1" placeholder="새로운 암호를 입력하세요">
    </div>
    <div class="form-group">
    <label for="exampleInputPassword2">비밀번호 확인</label>
    <input type="password" class="form-control" name="new_pw2" id="new_pw2" placeholder="새로운 암호를 한번 더 입력하세요">
    </div>
    <hr>
    <button style="float:right" id="submit" name="submit" type="button" class="btn btn-primary">변경</button>
</form>
<button style="float:right; margin: 0px 3px 0px 3px" class="btn btn-primary"  onclick = "location.href='/user/myinfo'">취소</button>
</div>
</div>
</div><!-- /.container -->
<script language="javascript">
    function validate() {
        let current_pw =  $("#current_pw").val();
        let new_pw1 = $("#new_pw1").val();
        let new_pw2 = $("#new_pw2").val();

        if(!current_pw)
        {
            alert("현재 암호가 입력되지 않았습니다.")
            return false;
        }


        if(!new_pw1)
        {
            alert("새로운 암호가 입력되지 않았습니다.")
            return false;
        }

        if(!new_pw2)
        {
            alert("비밀번호 확인란에 암호를 입력해주세요.")
            return false;
        }

        if (new_pw1 != new_pw2) {
            alert("암호가 서로 다릅니다. 다시입력하세요");
            return false;
        }
        return true;
    }

    /* 폼 전송 */
    $("#submit").click(
        function submitForm(event) {
            // 데이터 검증
            if(!validate()) return;

            // 폼데이터 담기
            var formData = new FormData();
            formData.append("current_pwd", document.getElementById("current_pw").value);
            formData.append("new_pw1", document.getElementById("new_pw1").value);

            $.ajax({
                method: 'PUT',
                url: '/user/alterpassword',
                dataType: 'json',
                data: formData,
                processData: false,     // 이녀석 false로 해줘야 multipart 타입 가능하다.
                contentType: false,     // 이녀석 false로 해줘야 multipart 타입 가능하다.
                async: true,
                timeout: 30000,
                cache: false,
                headers: {'cache-control': 'no-cache', 'pragma': 'no-cache'},
                success: function () {
                    alert("비밀번호가 변경되었습니다.");
                    window.location.href = '/';
                    return;
                },
                error: function (xhr, desc, err) {
                    alert("비밀번호 변경이 실패하였습니다.");
                    return;
                }
            })
        }
    );

</script>