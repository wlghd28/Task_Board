<link rel="stylesheet" href=<%=src_url + "public/stylesheets/style.css"%>>
<link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css" integrity="폰트어썸 본인 CDN" crossorigin="anonymous">
<link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:wght@200&display=swap" rel="stylesheet">
 
<!-- GNB(Global Navigation Bar) 부분 -->
 <body>
  <nav class="navbar">
          <div class="navbar__logo">
                  <i class="fab fa-amazon"></i>
                  <a href="#">GaOnCell</a>
          </div>
          <ul class="navbar__menu">
                <li class="nav-item dropdown">
                        <a style="padding:0px;" class="nav-link dropdown-toggle" href="#" id="navbarDropdown_Note" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">노트</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">     
                                <a class="dropdown-item" href="/note">노트기록</a>                 
                                <a class="dropdown-item" href="/note/list">노트조회</a>                                      
                        </div>
                </li>
                <li class="nav-item dropdown">
                        <a style="padding:0px;" class="nav-link dropdown-toggle" href="#" id="navbarDropdown_Report" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">보고서</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">     
                                <a class="dropdown-item" href="/report/week">주간보고</a>
                                <% if(level > 0) { %>
                                        <a class="dropdown-item" href="/report/list">보고서조회</a>
                                <% } %>                
                        </div>
                </li>
                <li class="nav-item dropdown">
                        <a style="padding:0px;" class="nav-link dropdown-toggle" href="#" id="navbarDropdown_Message" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">메시지</a>
                        <div class="dropdown-menu" aria-labelledby="navbarDropdown">     
                                <a class="dropdown-item" href="/message/send">메시지 쓰기</a>                              
                                <a class="dropdown-item" href="/message/sentlist/1">보낸 메시지함</a>     
                                <a id="navitem_receivedmessage" class="dropdown-item" href="/message/receivedlist/1">받은 메시지함</a>             
                        </div>
                </li>
                <li><a href="/noticeboard/list/1" id="navitem_noticeboard">게시판</a></li>
          </ul>
          <a href="#" class="navbar__toggleBtn"> <i class="fas fa-bars"></i> </a>
  </nav>
</body>

<script language="javascript">
        const toggleBtn = document.querySelector('.navbar__toggleBtn');
        const menu = document.querySelector('.navbar__menu');
        //const sns = document.querySelector('.navbar__sns');

        toggleBtn.addEventListener('click', () => {
                const toc_content = document.getElementById("toc-content");
                if(toc_content != null) toc_content.style.display = "none";
                menu.classList.toggle('active');
                //sns.classList.toggle('active');
        });

        GetNoticeAlarmStatus();
        GetMessageAlarmStatus();

        function GetNoticeAlarmStatus() {
                // 폼데이터 생성
                var formData = new FormData();
                // 폼 전송
                $.ajax({
                        method: 'GET',
                        url: '/noticeboard/notification',
                        dataType: 'json',
                        data: formData,
                        processData: false,     
                        contentType: false,     
                        async: true,
                        timeout: 30000,
                        cache: false,
                        headers: {'cache-control': 'no-cache', 'pragma': 'no-cache'},
                        success: function () {
                                //alert('알람상태 1');
                                document.getElementById("navitem_noticeboard").style.backgroundColor="orange";
                                return;
                        },
                        error: function (xhr, desc, err) {
                                //alert('알람상태 0');
                                document.getElementById("navitem_noticeboard").style.backgroundColor="none";
                                return;
                        }
                });
        }

        function GetMessageAlarmStatus() {
                // 폼데이터 생성
                var formData = new FormData();
                // 폼 전송
                $.ajax({
                        method: 'GET',
                        url: '/message/notification',
                        dataType: 'json',
                        data: formData,
                        processData: false,     
                        contentType: false,     
                        async: true,
                        timeout: 30000,
                        cache: false,
                        headers: {'cache-control': 'no-cache', 'pragma': 'no-cache'},
                        success: function () {
                                //alert('확인 안한 메시지 있는 상태');
                                document.getElementById("navbarDropdown_Message").style.backgroundColor="orange";
                                document.getElementById("navitem_receivedmessage").style.backgroundColor="orange";
                                return;
                        },
                        error: function (xhr, desc, err) {
                                //alert('모든 메시지 확인한 상태');
                                document.getElementById("navbarDropdown_Message").style.backgroundColor="none";
                                document.getElementById("navitem_receivedmessage").style.backgroundColor="none";
                                return;
                        }
                });
        }

</script>